# Celery Worker 정리

## 1) Celery worker란?
Celery **worker**는 Celery에서 **비동기 작업(task)을 큐에서 가져와 실행하는 실행 프로세스(또는 프로세스/스레드 풀)** 입니다.

### 전체 흐름(구성요소)
1. **Producer(작업을 넣는 쪽)**
   - 예: 웹 서버(Django/Flask/FastAPI)가 “이메일 발송”, “보고서 생성”, “영상 변환” 같은 일을 *즉시 처리하지 않고* 큐에 넣음
   - 보통 `task.delay()` / `task.apply_async()` 등으로 **작업 요청**만 보냄

2. **Broker(메시지 큐)**
   - 예: **Redis**, **RabbitMQ**
   - 처리해야 할 작업 메시지를 보관/전달

3. **Worker(일꾼)**
   - Broker에서 메시지를 **consume(가져오기)** 하고
   - 등록된 task 함수를 **실행**하며
   - (옵션) 결과 저장(result backend) 또는 완료 상태를 보고

### Worker가 하는 핵심 역할
- 큐를 **리스닝(consume)** 하면서 task를 가져옴
- **concurrency(동시성)** 설정에 따라 병렬 실행
- 재시도(retry), 타임아웃, 실패 처리, acks(작업 완료 확인) 등 실행 제어 담당

---

## 2) “파이썬으로 만든 데몬이야?”에 대한 답
대체로 **“네”에 가깝습니다.** Celery worker는 보통 **파이썬으로 실행되는 장시간 실행 프로세스**이며, 운영에서는 서비스처럼 상시 실행됩니다.

다만 정확히는:

- **Celery worker 자체는 “파이썬 프로그램(프로세스)”** 입니다.  
  예: `celery -A myapp worker ...` 로 실행하면 파이썬 런타임에서 돌아가는 프로세스가 됩니다.

- **데몬(daemon)인지 여부는 실행/관리 방식에 따라 달라집니다.**
  - 터미널에서 직접 실행: **포그라운드 프로세스** (데몬 X)
  - `systemd`, `supervisord`, Docker, Kubernetes 등으로 백그라운드 서비스로 실행: **데몬처럼 상시 실행** (운영 관점에서 데몬)

즉, 본질은 **“항상 켜져 있으면서 큐를 듣고 작업을 실행하는 파이썬 워커 프로세스”**이고, 운영에서는 보통 데몬처럼 관리합니다.

---

## 3) 추가로 알아두면 좋은 포인트
1. **워커 1개가 여러 실행 단위를 품을 수 있음**
   - 동시성 옵션에 따라:
     - `prefork`(기본): **부모 1 + 자식 프로세스 N개**
     - `threads`: 스레드 기반
     - `gevent/eventlet`: 코루틴 기반
   - 내부적으로 여러 작업을 동시에 처리할 수 있습니다.

2. 워커는 브로커(Redis/RabbitMQ)에 붙어 **메시지를 consume하는 소비자(consumer)** 입니다.
